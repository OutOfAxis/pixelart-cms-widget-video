<div class="wrapper">
  <div class='caption hidden'>
    Video url:
  </div>
  <div class='inp hidden'>
    <input id='inp' autofocus />
  </div>
  <div>
    <div class='caption'>
      Fit:
    </div>
    <div class='inp'>
      <select id='fit'>
        <option value='default' selected="selected">Default</option>
        <option value='center'>Center</option>
        <option value='fitWidth'>fit width</option>
        <option value='fitHeight'>fit height</option>
      </select>
    </div>
  </div>
  <div>
    <div class='caption'>
      How Many Times Plays:
    </div>
    <div class='inp'>
      <input type='number' id='multiplier' min="1"/>
    </div>
  </div>

</div>

<script>

  var id;
  var src;
  var duration;
  var param = {};

  window.addEventListener('message', function (e) {
    if (e.data.method === 'setParam') {
        src = e.data.param.src || '';
        document.getElementById('fit').value = e.data.param.fit || '';
        document.getElementById('multiplier').value = e.data.param.multiplier || 1;
        e.source.postMessage({
          method: 'ready',
          id: e.data.id,
          type: 'settings',
        }, e.origin);
        id = e.data.id;
    } else if (e.data.method === 'getParam') {
      var vid = document.createElement('video');
      vid.src = src;
      vid.addEventListener('canplay', function() {
        vid.removeEventListener('canplay', arguments.callee);
        duration = vid.duration;
        e.source.postMessage({
          method: 'setParam',
          id: id,
          param: {
            src: src,
            systemPreview: src,
            fit: document.getElementById('fit').value,
            multiplier: document.getElementById('multiplier').value,
            duration: vid.duration * document.getElementById('multiplier').value * 1000,
          },
          type: 'settings',
        }, e.origin);
      });
    } else {
      console.log('Uknown event', e);
    }

    document.getElementById('inp')
      .addEventListener('keyup', function(event) {
        event.preventDefault();
        if (event.keyCode == 13) {
          // FIX: repetition
          e.source.postMessage({
            method: 'setParam',
            id: id,
            param: {
              src: src,
              systemPreview: src,
              fit: document.getElementById('fit').value,
              multiplier: document.getElementById('multiplier').value,
              duration: duration * document.getElementById('multiplier').value * 1000,
            },
            type: 'settings',
          }, e.origin);
        }
      });

  }, false);

</script>

<style>
  * {
    padding: 0;
    margin: 0;
    font-family: Tahoma;
  }
  .wrapper {
    display: flex;
    flex-direction: column;
  }
  .caption {
    font-weight: normal;
    font-size: 13px;
    color: rgb(93, 100, 129);
    margin: 5px 0px;
  }

  #inp, #multiplier {
    outline: none !important;
    border-radius: 0px;
    background: rgba(234, 236, 238, 0.631373);
    color: rgb(51, 55, 70);
    height: 36px;
    margin-bottom: 15px;
    padding-left: 10px;
    width: 100%;
    transition: all 0.2s linear;
    box-sizing: border-box;
    border: 1px solid rgb(236, 236, 236);
  }

  .hidden {
    display: none;
  }

  #inp:focus, #multiplier:focus {
    box-shadow: rgb(155, 188, 171) 0px 2px 0px;
  }

  select#fit {
    display: block;
    -webkit-appearance: button;
    background: url(select-arrow.png) #F4F4F4;
    background-size: 8px 8px;
    margin-bottom: 15px;
    background-position: 97% center;
    background-repeat: no-repeat;
    border-radius: 0px;
    height: 36px;
    border: 1px solid #e0e0e0;
    color: #555;
    font-size: 13px;
    overflow: hidden;
    padding: 5px 10px;
    text-overflow: ellipsis;
    white-space: nowrap;
    width: 100%;
  }

  select:focus {
    outline: 1px solid rgba(126, 222, 174, 0.3);
  }
</style>
